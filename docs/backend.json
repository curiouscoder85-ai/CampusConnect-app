{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user account on the platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "role": {
          "type": "string",
          "description": "User's role (e.g., student, teacher, admin)."
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName",
        "role"
      ]
    },
    "Course": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Course",
      "type": "object",
      "description": "Represents a course offered on the platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the course entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the course."
        },
        "description": {
          "type": "string",
          "description": "Description of the course."
        },
        "teacherId": {
          "type": "string",
          "description": "Reference to Teacher. (Relationship: Teacher 1:N Course)"
        },
        "status": {
          "type": "string",
          "description": "Status of course (e.g., draft, published, archived)."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "teacherId",
        "status"
      ]
    },
    "Enrollment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Enrollment",
      "type": "object",
      "description": "Represents a student's enrollment in a course.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the enrollment entity."
        },
        "studentId": {
          "type": "string",
          "description": "Reference to Student. (Relationship: Student 1:N Enrollment)"
        },
        "courseId": {
          "type": "string",
          "description": "Reference to Course. (Relationship: Course 1:N Enrollment)"
        },
        "enrollmentDate": {
          "type": "string",
          "description": "Date when the student enrolled in the course.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "studentId",
        "courseId",
        "enrollmentDate"
      ]
    },
    "Assignment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Assignment",
      "type": "object",
      "description": "Represents an assignment within a course.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the assignment entity."
        },
        "courseId": {
          "type": "string",
          "description": "Reference to Course. (Relationship: Course 1:N Assignment)"
        },
        "title": {
          "type": "string",
          "description": "Title of the assignment."
        },
        "description": {
          "type": "string",
          "description": "Description of the assignment."
        },
        "dueDate": {
          "type": "string",
          "description": "Due date for the assignment.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "courseId",
        "title",
        "description",
        "dueDate"
      ]
    },
    "Submission": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Submission",
      "type": "object",
      "description": "Represents a student's submission for an assignment.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the submission entity."
        },
        "assignmentId": {
          "type": "string",
          "description": "Reference to Assignment. (Relationship: Assignment 1:N Submission)"
        },
        "studentId": {
          "type": "string",
          "description": "Reference to Student. (Relationship: Student 1:N Submission)"
        },
        "submissionDate": {
          "type": "string",
          "description": "Date when the student submitted the assignment.",
          "format": "date-time"
        },
        "content": {
          "type": "string",
          "description": "The content of the submission."
        },
        "grade": {
          "type": "number",
          "description": "Grade received for the submission."
        }
      },
      "required": [
        "id",
        "assignmentId",
        "studentId",
        "submissionDate",
        "content"
      ]
    },
    "Feedback": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Feedback",
      "type": "object",
      "description": "Represents student feedback on a course.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the feedback entity."
        },
        "courseId": {
          "type": "string",
          "description": "Reference to Course. (Relationship: Course 1:N Feedback)"
        },
        "studentId": {
          "type": "string",
          "description": "Reference to Student. (Relationship: Student 1:N Feedback)"
        },
        "rating": {
          "type": "number",
          "description": "Rating given by the student (e.g., 1-5 stars)."
        },
        "comment": {
          "type": "string",
          "description": "Comments provided by the student."
        },
        "feedbackDate": {
          "type": "string",
          "description": "Date the feedback was submitted",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "courseId",
        "studentId",
        "rating",
        "comment",
        "feedbackDate"
      ]
    },
    "Certificate": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Certificate",
      "type": "object",
      "description": "Represents a certificate awarded to a student for completing a course.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the certificate entity."
        },
        "studentId": {
          "type": "string",
          "description": "Reference to Student. (Relationship: Student 1:N Certificate)"
        },
        "courseId": {
          "type": "string",
          "description": "Reference to Course. (Relationship: Course 1:N Certificate)"
        },
        "certificateDate": {
          "type": "string",
          "description": "Date when the certificate was issued.",
          "format": "date-time"
        },
        "certificateURL": {
          "type": "string",
          "description": "URL where the certificate is stored.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "studentId",
        "courseId",
        "certificateDate",
        "certificateURL"
      ]
    },
    "Recommendation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Recommendation",
      "type": "object",
      "description": "Represents an AI-powered content recommendation for a student.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the recommendation."
        },
        "studentId": {
          "type": "string",
          "description": "Reference to Student. (Relationship: Student 1:N Recommendation)"
        },
        "contentId": {
          "type": "string",
          "description": "Reference to the learning material being recommended. Could refer to a Course, Assignment, Video, etc."
        },
        "contentType": {
          "type": "string",
          "description": "The type of content being recommended (e.g., 'course', 'assignment', 'video')."
        },
        "recommendationDate": {
          "type": "string",
          "description": "Date when the recommendation was generated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "studentId",
        "contentId",
        "contentType",
        "recommendationDate"
      ]
    },
     "ChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Chat Message",
      "type": "object",
      "description": "Represents a single message in a chat conversation.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the message."
        },
        "text": {
          "type": "string",
          "description": "The content of the message."
        },
        "role": {
          "type": "string",
          "enum": ["user", "bot"],
          "description": "Who sent the message."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when the message was sent."
        }
      },
      "required": ["id", "text", "role", "createdAt"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Uses path-based ownership for user-specific data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
       {
        "path": "/users/{userId}/chatHistory/{messageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": {
            "$ref": "#/backend/entities/ChatMessage"
          },
          "description": "Stores chat history for each user. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "messageId",
              "description": "The unique identifier for the chat message."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}",
        "definition": {
          "entityName": "Course",
          "schema": {
            "$ref": "#/backend/entities/Course"
          },
          "description": "Stores course information. Includes 'teacherId' for authorization independence.",
          "params": [
            {
              "name": "courseId",
              "description": "The unique identifier for the course."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/certificates/{certificateId}",
        "definition": {
          "entityName": "Certificate",
          "schema": {
            "$ref": "#/backend/entities/Certificate"
          },
          "description": "Stores certificates earned by users. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "certificateId",
              "description": "The unique identifier for the certificate."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}/assignments/{assignmentId}",
        "definition": {
          "entityName": "Assignment",
          "schema": {
            "$ref": "#/backend/entities/Assignment"
          },
          "description": "Stores assignments for each course.  Includes denormalized 'teacherId' inherited from the parent course for authorization independence.",
          "params": [
            {
              "name": "courseId",
              "description": "The unique identifier for the course."
            },
            {
              "name": "assignmentId",
              "description": "The unique identifier for the assignment."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}/feedback/{feedbackId}",
        "definition": {
          "entityName": "Feedback",
          "schema": {
            "$ref": "#/backend/entities/Feedback"
          },
          "description": "Stores feedback for each course. Includes denormalized 'teacherId' inherited from the parent course for authorization independence.",
          "params": [
            {
              "name": "courseId",
              "description": "The unique identifier for the course."
            },
            {
              "name": "feedbackId",
              "description": "The unique identifier for the feedback."
            }
          ]
        }
      },
      {
        "path": "/enrollments/{enrollmentId}",
        "definition": {
          "entityName": "Enrollment",
          "schema": {
            "$ref": "#/backend/entities/Enrollment"
          },
          "description": "Stores enrollment records. Includes 'courseId' and 'studentId' for authorization independence.",
          "params": [
            {
              "name": "enrollmentId",
              "description": "The unique identifier for the enrollment."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}/assignments/{assignmentId}/submissions/{submissionId}",
        "definition": {
          "entityName": "Submission",
          "schema": {
            "$ref": "#/backend/entities/Submission"
          },
          "description": "Stores submissions for each assignment.",
          "params": [
            {
              "name": "courseId",
              "description": "The unique identifier for the course."
            },
            {
              "name": "assignmentId",
              "description": "The unique identifier for the assignment."
            },
            {
              "name": "submissionId",
              "description": "The unique identifier for the submission."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/recommendations/{recommendationId}",
        "definition": {
          "entityName": "Recommendation",
          "schema": {
            "$ref": "#/backend/entities/Recommendation"
          },
          "description": "Stores AI-powered content recommendations for each student. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "recommendationId",
              "description": "The unique identifier for the recommendation."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to provide a secure, scalable, and easily maintainable backend for the CampusConnect E-Learning platform. The structure prioritizes authorization independence by denormalizing relevant access control data, thus avoiding complex `get()` calls in security rules. Segregation of data based on access patterns is employed to simplify security rules and ensure QAPs (Rules are not Filters). The design implements path-based ownership where applicable and standardizes access modeling using membership maps for collaborative data.\n\n**Authorization Independence (Denormalization):**\n\n*   The `courses` collection stores `teacherId` to ensure that only the teacher who created the course or an admin can modify the course details.\n*   The `enrollments` collection stores the `courseId` and `studentId`, which allows for checking enrollment status efficiently without having to perform complex queries or relying on parent document data in the security rules. Also, the `assignments` and `feedback` subcollections denormalize `teacherId` inherited from the parent course.\n\n**QAPs (Rules are not Filters):**\n\n*   The structure employs structural segregation, creating dedicated collections/subcollections for different access requirements. For instance, courses are stored in the `courses` collection, and student-specific data is stored within the `/users/{userId}` path, ensuring that listing operations can be securely filtered based on user roles and permissions.\n*   Path-based ownership for user-related data enables efficient and secure `list` operations, as the security rules can easily filter based on the `userId` parameter in the path.\n\n**Access Modeling:**\n\n*   Private Data: User-specific data (e.g., certificates, recommendations) is stored under `/users/{userId}`, enforcing path-based ownership.\n*   Collaborative Data: While the core model doesn't explicitly use membership maps, the relationships between entities (e.g., Course and Enrollment) implicitly define collaborative access, which can be further extended using membership maps in the future if more complex collaboration scenarios arise.\n*   Admin Roles: The structure can be extended with a `/roles_admin/{uid}` collection to manage admin roles without custom claims.\n\n**Invariants:**\n\n*   The structure supports invariants through explicit state modeling using the `status` field in the `Course` entity and enforces ownership using `teacherId`.\n\nThe proposed structure enables simple, robust, and easily debuggable security rules by adhering to the core design principles and strategies. This structure ensures that the application is secure, scalable, and maintainable."
  }
}